----------------------------------------------------------
      name:  <unnamed>
       log:  /Users/lsh152058/Documents/GitHub/ethnicity-c
> ovid-research/logs/11a_eth_an_infectedpop_eth16.log
  log type:  text
 opened on:  16 Jan 2021, 20:51:24

. 
. cap file close tablecontent

. file open tablecontent using ./output/table4_infectedpop
> _eth16_nocarehomes.txt, write text replace

. file write tablecontent ("Table 3: Odds of testing posit
> ive amongst those receiving a test - No care homes") _n

. file write tablecontent _tab ("Denominator") _tab ("Even
> t") _tab ("%") _tab ("Crude") _tab _tab ("Age/Sex Adjust
> ed") _tab _tab ("Age/Sex/IMD Adjusted") _tab _tab       
> ("plus co-morbidities") _tab _tab       ("plus hh size")
>   _n

. 
. file write tablecontent _tab _tab _tab _tab   ("OR") _ta
> b ("95% CI") _tab ("OR") _tab ("95% CI") _tab ("OR") _ta
> b ("95% CI") _tab ("OR") _tab ("95% CI") _tab ("95% CI")
>  _tab ("95% CI") _n

. 
. 
. foreach i of global outcomes {
  2. * Open Stata dataset
. use ./output/analysis_dataset.dta, clear
  3. 
. *define population as anyone who has received a test
. keep if positivetest==1
  4. safecount
  5. 
. keep if carehome==0 
  6. safecount
  7. 
. /* keep those with at least 30 days f-up after positivet
> est ====================================================
> ===*/ 
. gen fup=stime_`i'-positivetest_date
  8. sum fup
  9. drop if fup<30
 10. sum fup
 11. 
. /* Create outcomes to be within 30 days of positivetest 
> =======================================================*
> / 
. 
. gen `i'_30=0
 12. replace `i'_30=1 if (`i'_date - positivetest_date) <=
> 30  & `i'_date <= stime_`i'
 13. tab `i' `i'_30
 14. 
. /* Sense check outcomes=================================
> ======================*/ 
. safetab positivetest `i'_30
 15. 
. safetab ethnicity_16 `i'_30, missing row
 16. 
. 
. /* Main Model===========================================
> ======================*/
. 
. /* Univariable model */ 
. 
. cap logistic `i'_30 i.ethnicity_16 i.stp, nolog 
 17. cap estimates save ./output/crude_`i'_eth16, replace 
 18. cap parmest, label eform format(estimate p lb ub) sav
> ing(./output/crude_`i'_eth16, replace) idstr("crude_`i'_
> eth16") 
 19. cap eststo model1
 20. local hr "`hr' ./output/crude_`i'_eth16 "
 21. 
. 
. /* Multivariable models */ 
. *Age Gender
. cap logistic `i'_30 i.ethnicity_16 i.male age1 age2 age3
>  i.stp, nolog 
 22. cap estimates save ./output/model0_`i'_eth16, replace
>  
 23. cap parmest, label eform format(estimate p lb ub) sav
> ing(./output/model0_`i'_eth16, replace) idstr("model0_`i
> '_eth16") 
 24. cap eststo model2
 25. local hr "`hr' ./output/model0_`i'_eth16 "
 26. 
. * Age, Gender, IMD
. cap logistic `i'_30 i.ethnicity_16 i.male age1 age2 age3
>  i.imd i.stp , nolog 
 27. cap estimates save ./output/model1_`i'_eth16, replace
>  
 28. cap parmest, label eform format(estimate p lb ub) sav
> ing(./output/model1_`i'_eth16, replace) idstr("model1_`i
> '_eth16") 
 29. cap eststo model3
 30. local hr "`hr' ./output/model1_`i'_eth16 "
 31. 
. * Age, Gender, IMD and Comorbidities  
. cap logistic `i'_30 i.ethnicity_16 i.male age1 age2 age3
>         i.imd                                           
> ///
>                                                         
>                         i.bmicat_sa     i.hba1ccat      
>                 ///
>                                                         
>                         gp_consult_count                
>         ///
>                                                         
>                         i.smoke_nomiss                  
>         ///
>                                                         
>                         i.hypertension i.bp_cat         
> ///     
>                                                         
>                         i.asthma                        
>                 ///
>                                                         
>                         i.chronic_respiratory_disease //
> /
>                                                         
>                         i.chronic_cardiac_disease       
> ///
>                                                         
>                         i.dm_type                       
>                 ///     
>                                                         
>                         i.cancer                    ///
>                                                         
>                         i.chronic_liver_disease         
> ///
>                                                         
>                         i.stroke                        
>                 ///
>                                                         
>                         i.dementia                      
>                 ///
>                                                         
>                         i.other_neuro                   
>         ///
>                                                         
>                         i.egfr60                        
>                 ///
>                                                         
>                         i.esrf                          
>                 ///
>                                                         
>                         i.immunosuppressed              
>         ///
>                                                         
>                         i.ra_sle_psoriasis      i. stp, 
> nolog           
 32.                                                      
>                            
. cap estimates save ./output/model2_`i'_eth16, replace 
 33. cap parmest, label eform format(estimate p lb ub) sav
> ing(./output/model2_`i'_eth16, replace) idstr("model2_`i
> '_eth16") 
 34. cap eststo model4
 35. local hr "`hr' ./output/model2_`i'_eth16 "
 36. 
. * Age, Gender, IMD and Comorbidities  and household size
>  
. cap logistic `i'_30 i.ethnicity_16 i.male age1 age2 age3
>         i.imd                                           
> ///
>                                                         
>                         i.bmicat_sa     i.hba1ccat      
>                 ///
>                                                         
>                         gp_consult_count                
>         ///
>                                                         
>                         i.smoke_nomiss                  
>         ///
>                                                         
>                         i.hypertension i.bp_cat         
> ///     
>                                                         
>                         i.asthma                        
>                 ///
>                                                         
>                         i.chronic_respiratory_disease //
> /
>                                                         
>                         i.chronic_cardiac_disease       
> ///
>                                                         
>                         i.dm_type                       
>                 ///     
>                                                         
>                         i.cancer                    ///
>                                                         
>                         i.chronic_liver_disease         
> ///
>                                                         
>                         i.stroke                        
>                 ///
>                                                         
>                         i.dementia                      
>                 ///
>                                                         
>                         i.other_neuro                   
>         ///
>                                                         
>                         i.egfr60                        
>                 ///
>                                                         
>                         i.esrf                          
>                 ///
>                                                         
>                         i.immunosuppressed              
>         ///
>                                                         
>                         i.ra_sle_psoriasis              
>         ///
>                                                         
>                         i.hh_total_cat i.stp, nolog     
>         
 37.                                                      
>                            
. cap estimates save ./output/model3_`i'_eth16, replace 
 38. cap parmest, label eform format(estimate p lb ub) sav
> ing(./output/model3_`i'_eth16, replace) idstr("model3_`i
> '_eth16") 
 39. cap eststo model5
 40. local hr "`hr' ./output/model3_`i'_eth16 "
 41. 
. /* Estout===============================================
> =================*/ 
. cap esttab model1 model2 model3 model4 model5  using ./o
> utput/estout_table4_infectedpop_eth16_nocarehomes.txt, b
> (a2) ci(2) label wide compress eform ///
>         title ("`i'") ///
>         varlabels(`e(labels)') ///
>         stats(N_sub) ///
>         append 
 42. eststo clear
 43. 
. 
. 
. /* Print table==========================================
> ======================*/ 
. *  Print the results for the main model 
. 
. 
. * Column headings 
. file write tablecontent ("`i'") _n
 44. 
. * eth16 labelled columns
. 
. local lab1: label ethnicity_16 1
 45. local lab2: label ethnicity_16 2
 46. local lab3: label ethnicity_16 3
 47. local lab4: label ethnicity_16 4
 48. local lab5: label ethnicity_16 5
 49. local lab6: label ethnicity_16 6
 50. local lab7: label ethnicity_16 7
 51. local lab8: label ethnicity_16 8
 52. local lab9: label ethnicity_16 9
 53. local lab10: label ethnicity_16 10
 54. local lab11: label ethnicity_16 11
 55. local lab12: label ethnicity_16 12
 56. local lab13: label ethnicity_16 13
 57. local lab14: label ethnicity_16 14
 58. local lab15: label ethnicity_16 15
 59. local lab16: label ethnicity_16 16
 60. local lab17: label ethnicity_16 17
 61. 
. /* Counts */
.  
. * First row, eth16 = 1 (White) reference cat
.         qui safecount if ethnicity_16==1
 62.         local denominator = r(N)
 63.         qui safecount if ethnicity_16 == 1 & `i' == 1
 64.         local event = r(N)
 65.         local pct =(`event'/`denominator')
 66.         file write tablecontent  ("`lab1'") _tab (`de
> nominator') _tab (`event') _tab %3.2f (`pct') _tab
 67.         file write tablecontent ("1.00") _tab _tab ("
> 1.00") _tab _tab ("1.00")  _tab _tab ("1.00") _tab _tab 
> ("1.00") _n
 68.         
. * Subsequent ethnic groups
. forvalues eth=2/17 {
 69.         qui safecount if ethnicity_16==`eth'
 70.         local denominator = r(N)
 71.         qui safecount if ethnicity_16 == `eth' & `i' 
> == 1
 72.         local event = r(N)
 73.         local pct =(`event'/`denominator')
 74.         file write tablecontent  ("`lab`eth''") _tab 
> (`denominator') _tab (`event') _tab %3.2f (`pct') _tab
 75.         cap estimates use ./output/crude_`i'_eth16" 
 76.         cap lincom `eth'.ethnicity_16, eform
 77.         file write tablecontent  %4.2f (r(estimate)) 
> _tab ("(") %4.2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _ta
> b 
 78.         cap estimates clear
 79.         cap estimates use ./output/model0_`i'_eth16" 
 80.         cap lincom `eth'.ethnicity_16, eform
 81.         file write tablecontent  %4.2f (r(estimate)) 
> _tab ("(") %4.2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _ta
> b 
 82.         cap estimates clear
 83.         cap estimates use ./output/model1_`i'_eth16" 
 84.         cap lincom `eth'.ethnicity_16, eform
 85.         file write tablecontent  %4.2f (r(estimate)) 
> _tab ("(") %4.2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _ta
> b 
 86.         cap estimates clear
 87.         cap estimates use ./output/model2_`i'_eth16" 
 88.         cap lincom `eth'.ethnicity_16, eform
 89.         file write tablecontent  %4.2f (r(estimate)) 
> _tab ("(") %4.2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _ta
> b 
 90.         cap estimates clear
 91.         cap estimates use ./output/model3_`i'_eth16" 
 92.         cap lincom `eth'.ethnicity_16, eform
 93.         file write tablecontent  %4.2f (r(estimate)) 
> _tab ("(") %4.2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _n
 94. }  //end ethnic group
 95. 
. } //end outcomes
(68,938 observations deleted)
  9,746
(1,521 observations deleted)
  8,225

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      8,225    77.44195    64.34212       -1
> 78        183
(1,976 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      6,249    104.1301    44.01002         
> 30        183
(1 real change made)

   outcome |        hes_30
       hes |         0          1 |     Total
-----------+----------------------+----------
         0 |     5,891          0 |     5,891 
         1 |       357          1 |       358 
-----------+----------------------+----------
     Total |     6,248          1 |     6,249 

**TABLE OF positivetest hes_30 REDACTED DUE TO SMALL N**


**TABLE OF ethnicity_16 hes_30 REDACTED DUE TO SMALL N**

(68,938 observations deleted)
  9,746
(1,521 observations deleted)
  8,225

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      8,225     75.0817    63.00366       -1
> 80        179
(2,044 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      6,181    101.9298    43.12947         
> 30        179
(4 real changes made)

   outcome |        icu_30
       icu |         0          1 |     Total
-----------+----------------------+----------
         0 |     5,845          0 |     5,845 
         1 |       332          4 |       336 
-----------+----------------------+----------
     Total |     6,177          4 |     6,181 

**TABLE OF positivetest icu_30 REDACTED DUE TO SMALL N**


**TABLE OF ethnicity_16 icu_30 REDACTED DUE TO SMALL N**

(68,938 observations deleted)
  9,746
(1,521 observations deleted)
  8,225

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      8,225    89.66553    53.25271         
>  0        183
(1,435 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      6,790    105.6495    44.21588         
> 30        183
(0 real changes made)

   outcome | onscovidde
onscovidde |   ath_30
       ath |         0 |     Total
-----------+-----------+----------
         0 |     6,693 |     6,693 
         1 |        97 |        97 
-----------+-----------+----------
     Total |     6,790 |     6,790 

   outcome | onscovidde
positivete |   ath_30
        st |         0 |     Total
-----------+-----------+----------
         1 |     6,790 |     6,790 
-----------+-----------+----------
     Total |     6,790 |     6,790 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                  | onscovidde
                  |   ath_30
Eth 16 categories |         0 |     Total
------------------+-----------+----------
          British |       313 |       313 
                  |    100.00 |    100.00 
------------------+-----------+----------
            Irish |       319 |       319 
                  |    100.00 |    100.00 
------------------+-----------+----------
      Other White |       303 |       303 
                  |    100.00 |    100.00 
------------------+-----------+----------
White + Caribbean |       331 |       331 
                  |    100.00 |    100.00 
------------------+-----------+----------
  White + African |       317 |       317 
                  |    100.00 |    100.00 
------------------+-----------+----------
    White + Asian |       315 |       315 
                  |    100.00 |    100.00 
------------------+-----------+----------
      Other mixed |       339 |       339 
                  |    100.00 |    100.00 
------------------+-----------+----------
           Indian |       308 |       308 
                  |    100.00 |    100.00 
------------------+-----------+----------
        Pakistani |       343 |       343 
                  |    100.00 |    100.00 
------------------+-----------+----------
      Bangladeshi |       303 |       303 
                  |    100.00 |    100.00 
------------------+-----------+----------
      Other Asian |       301 |       301 
                  |    100.00 |    100.00 
------------------+-----------+----------
        Caribbean |       310 |       310 
                  |    100.00 |    100.00 
------------------+-----------+----------
          African |       314 |       314 
                  |    100.00 |    100.00 
------------------+-----------+----------
      Other Black |       317 |       317 
                  |    100.00 |    100.00 
------------------+-----------+----------
          Chinese |       344 |       344 
                  |    100.00 |    100.00 
------------------+-----------+----------
            Other |       328 |       328 
                  |    100.00 |    100.00 
------------------+-----------+----------
          Unknown |     1,685 |     1,685 
                  |    100.00 |    100.00 
------------------+-----------+----------
            Total |     6,790 |     6,790 
                  |    100.00 |    100.00 
(68,938 observations deleted)
  9,746
(1,521 observations deleted)
  8,225

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      8,225    89.66553    53.25271         
>  0        183
(1,435 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      6,790    105.6495    44.21588         
> 30        183
(3 real changes made)

   outcome |
ons_noncov | ons_noncoviddeath_30
   iddeath |         0          1 |     Total
-----------+----------------------+----------
         0 |     6,470          0 |     6,470 
         1 |       317          3 |       320 
-----------+----------------------+----------
     Total |     6,787          3 |     6,790 

**TABLE OF positivetest ons_noncoviddeath_30 REDACTED DUE 
> TO SMALL N**


**TABLE OF ethnicity_16 ons_noncoviddeath_30 REDACTED DUE 
> TO SMALL N**

(68,938 observations deleted)
  9,746
(1,521 observations deleted)
  8,225

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      8,225    89.66553    53.25271         
>  0        183
(1,435 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       M
> in        Max
-------------+--------------------------------------------
> -------------
         fup |      6,790    105.6495    44.21588         
> 30        183
(3 real changes made)

   outcome |      onsdeath_30
  onsdeath |         0          1 |     Total
-----------+----------------------+----------
         0 |     6,373          0 |     6,373 
         1 |       414          3 |       417 
-----------+----------------------+----------
     Total |     6,787          3 |     6,790 

**TABLE OF positivetest onsdeath_30 REDACTED DUE TO SMALL 
> N**


**TABLE OF ethnicity_16 onsdeath_30 REDACTED DUE TO SMALL 
> N**


. file close tablecontent

. 
. ************************************************create f
> orestplot dataset
. cap dsconcat `hr'

. cap duplicates drop

. cap split idstr, p(_)

. cap ren idstr1 model

. cap ren idstr2 outcome

. cap drop idstr idstr3

. cap tab model

. 
. *save dataset for later
. outsheet using ./output/FP_infectedpop_eth16.txt, replac
> e

. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  /Users/lsh152058/Documents/GitHub/ethnicity-c
> ovid-research/logs/11a_eth_an_infectedpop_eth16.log
  log type:  text
 closed on:  16 Jan 2021, 20:51:32
----------------------------------------------------------
